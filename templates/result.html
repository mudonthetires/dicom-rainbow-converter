<!DOCTYPE html>
<html>
<head>
    <title>Processed Image</title>
    <style>
        /* Make the image larger initially */
        #image {
            transition: transform 0.2s; /* Smooth zoom effect */
            max-width: 100%;  /* Ensures the image fits within its container */
            max-height: 600px;  /* Set a max height to prevent huge images */
            cursor: grab;  /* Indicate to the user that the image is draggable */
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center center;  /* Keep zoom/pan centered */
            transform: translate(-50%, -50%);  /* Center image */
        }

        /* Container to hold the image and buttons */
        #image-container {
            position: relative;
            overflow: hidden;  /* Prevent the image from going outside its bounds */
            width: 100%;  /* Full width of the container */
            height: 600px;  /* Set a fixed height */
            text-align: center;
        }

        /* Ensure buttons appear above the image */
        #controls {
            position: absolute;
            top: 80%;
            width: 100%;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Processed Image</h1>
    
    <div id="image-container">
        <img id="image" src="{{ url_for('processed_file', filename=filename) }}" alt="Rainbow DICOM Image">
        <div id="controls">
            <label for="zoomSlider">Zoom:</label>
            <input type="range" id="zoomSlider" min="0.5" max="3" step="0.1" value="1">
            <span id="zoomValue">100%</span>
            <br>
            <a href="{{ url_for('download_file', filename=filename) }}" download>
                <button>Download Processed Image</button>
            </a>
        </div>
    </div>

    <script>
        const slider = document.getElementById("zoomSlider");
        const zoomValue = document.getElementById("zoomValue");
        const image = document.getElementById("image");

        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let offsetX = 0;
        let offsetY = 0;

        slider.addEventListener("input", function() {
            const zoomLevel = slider.value;
            zoomValue.textContent = `${Math.round(zoomLevel * 100)}%`;  // Update zoom value text
            image.style.transform = `translate(-50%, -50%) scale(${zoomLevel})`;  // Apply zoom to image while keeping it centered
        });

        // Start dragging
        image.addEventListener("mousedown", (e) => {
            isDragging = true;
            startX = e.clientX - offsetX;
            startY = e.clientY - offsetY;
            image.style.cursor = "grabbing";  // Change cursor when dragging
        });

        // Drag the image
        window.addEventListener("mousemove", (e) => {
            if (isDragging) {
                offsetX = e.clientX - startX;
                offsetY = e.clientY - startY;
                image.style.transform = `translate(-50%, -50%) scale(${slider.value}) translate(${offsetX}px, ${offsetY}px)`;
            }
        });

        // Stop dragging
        window.addEventListener("mouseup", () => {
            isDragging = false;
            image.style.cursor = "grab";  // Reset cursor after dragging
        });
    </script>
</body>
</html>

